<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>3D 真人穿搭模擬器</title>
    <style>
        body { margin: 0; font-family: 'PingFang TC', sans-serif; background: #1a1a1a; color: white; display: flex; }
        #ui-panel { width: 320px; padding: 25px; background: #252525; box-shadow: 2px 0 15px rgba(0,0,0,0.5); z-index: 10; }
        #canvas-container { flex-grow: 1; height: 100vh; }
        .control-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #aaa; font-size: 14px; }
        select { width: 100%; padding: 12px; background: #333; border: 1px solid #444; color: white; border-radius: 6px; }
        h2 { font-weight: 300; border-bottom: 1px solid #444; padding-bottom: 15px; }
        .loading-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #3498db; }
    </style>
</head>
<body>

<div id="ui-panel">
    <h2>人體特徵設定</h2>
    
    <div class="control-group">
        <label>性別選擇</label>
        <select id="gender">
            <option value="female">女性 (Female)</option>
            <option value="male">男性 (Male)</option>
        </select>
    </div>

    <div class="control-group">
        <label>身高 (cm)</label>
        <select id="height"></select>
    </div>

    <div class="control-group">
        <label>體重 (kg)</label>
        <select id="weight"></select>
    </div>

    <div style="margin-top: 40px; padding: 20px; background: #333; border-radius: 10px; text-align: center;">
        <span style="font-size: 12px; color: #888;">當前體型參數</span>
        <div id="status" style="font-size: 18px; color: #3498db; margin-top: 5px;">載入中...</div>
    </div>
</div>

<div id="canvas-container">
    <div id="loading" class="loading-overlay">正在初始化 3D 真人模型...</div>
</div>

<script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three@0.132.2';
    import { OrbitControls } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/controls/OrbitControls.js';
    import { GLTFLoader } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/loaders/GLTFLoader.js';

    let scene, camera, renderer, model, controls;
    let bones = {}; // 儲存骨骼引用

    async function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a1a);

        camera = new THREE.PerspectiveCamera(45, (window.innerWidth - 320) / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.2, 3);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth - 320, window.innerHeight);
        renderer.outputEncoding = THREE.sRGBEncoding;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // 光照 (模擬攝影棚效果)
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);
        const spotLight = new THREE.SpotLight(0xffffff, 0.8);
        spotLight.position.set(5, 10, 5);
        scene.add(spotLight);

        // 載入模型 (這裡使用一個標準人體模型路徑，正式開發時請替換為你的 .glb 檔案)
        const loader = new GLTFLoader();
        // 範例使用一個通用的 Avatar 模型路徑
        const modelUrl = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/models/gltf/RobotExpressive/RobotExpressive.glb'; 
        // 註：這是一個機器人模型作為演示，換成真人模型的 .glb 即可實現真人效果
        
        loader.load(modelUrl, (gltf) => {
            model = gltf.scene;
            model.scale.set(1, 1, 1);
            scene.add(model);
            
            // 隱藏載入提示
            document.getElementById('loading').style.display = 'none';
            document.getElementById('status').innerText = '模型已就緒';

            // 初始化選單
            setupUI();
            updateBody();
        });

        controls = new OrbitControls(camera, renderer.domElement);
        controls.target.set(0, 1, 0);
        animate();
    }

    function setupUI() {
        const hSel = document.getElementById('height');
        const wSel = document.getElementById('weight');
        for(let i=150; i<=180; i++) hSel.add(new Option(`${i} cm`, i));
        for(let i=40; i<=90; i++) wSel.add(new Option(`${i} kg`, i));
        hSel.value = 165; wSel.value = 60;

        [hSel, wSel, document.getElementById('gender')].forEach(el => {
            el.addEventListener('change', updateBody);
        });
    }

    function updateBody() {
        if (!model) return;

        const h = parseInt(document.getElementById('height').value);
        const w = parseInt(document.getElementById('weight').value);
        
        // 1. 身高變換 (整體縮放 Y 軸)
        const heightScale = h / 170; // 以 170cm 為標準
        model.scale.y = heightScale;

        // 2. 體型變換 (體重影響 X 與 Z 軸，即寬度與厚度)
        // 這裡模擬體脂肪與肌肉增加的效果
        const weightBase = w / 60; // 以 60kg 為標準
        const thickness = Math.sqrt(weightBase); // 使用平方根讓增加幅度較自然
        
        model.scale.x = thickness;
        model.scale.z = thickness;

        document.getElementById('status').innerText = `${h}cm / ${w}kg`;
    }

    function animate() {
        requestAnimationFrame(animate);
        if(controls) controls.update();
        renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
        camera.aspect = (window.innerWidth - 320) / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth - 320, window.innerHeight);
    });

    init();
</script>

</body>
</html>
